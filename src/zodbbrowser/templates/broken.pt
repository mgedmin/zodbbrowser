<metal:block metal:use-macro="view/@@zodbbrowser_macros/page">
  <metal:block fill-slot="content">

    <div class="object"
         tal:define="available view/isFeatureAvailable">

      <div class="heading">
        <h1><a href="@@zodbbrowser">Broken ZODB objects</a></h1>
      </div>

      <tal:documentation tal:condition="not: available">
        <div>
          <p>
            This feature is not available. In order to have it here,
            you need to first run the zodbcheck script, saving the
            information generated by this script with the help of the
            <tt>--save-references</tt> option and give it to
            zodbbrowser with the option <tt>--load-references</tt>.
          </p>
        </div>
      </tal:documentation>

      <tal:available tal:condition="available">
        <div tal:define="broken view/getBrokenObjects">
          <p tal:condition="not: broken">
            Felicitations ! There is no broken objects in your site.
          </p>
          <p tal:condition="broken">
            You are doomed ! There are broken objects !
          </p>
          <ul tal:condition="broken">
            <li tal:repeat="reference broken">
              <a href="#"
                 tal:attributes="href string:@@zodbbrowser?oid=${reference/oid}"
                 tal:content="structure reference/info">
                OID
              </a>
            </li>
          </ul>
          <p>
            To refresh this list, you need to re-run the zodbcheck
            script and restart zodbupdate with the newly generated
            reference database.
          </p>
        </div>
      </tal:available>
      <div class="footer">
        <a tal:attributes="href view/homepage">zodb browser</a>
        v<span tal:replace="view/version" />
        | <a id="help" href="@@zodbbrowser_help">help</a>
      </div>

    </div>

  </metal:block>
</metal:block>

